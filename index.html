<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>抽卡互動網站</title>
<style>
:root{
  --bg1:#fffaf5; --bg2:#f7fbff;
  --panel:#ffffff; --panel-border: rgba(15,23,42,.08);
  --text:#111827; --muted:#64748b;
  --ring: rgba(255,62,165,.35);
}
body{margin:0; background: linear-gradient(120deg, var(--bg1), var(--bg2)); font-family: sans-serif;}
.wrap{max-width:1100px; margin:0 auto; padding:24px;}
.panel{background:var(--panel); border:1px solid var(--panel-border); border-radius:20px;}
.controls{display:grid; grid-template-columns: 1fr 1fr auto auto auto; gap:12px; padding:16px;}
select,button{border:1px solid var(--panel-border); border-radius:999px; padding:10px 14px;}
button{cursor:pointer; font-weight:600;}
.btn-primary{background:linear-gradient(135deg, #ff3ea5, #ff7fd1); color:white;}
.btn-secondary{background:linear-gradient(135deg, #7c3aed, #9d6bff); color:white;}
.btn-ok{background:linear-gradient(135deg, #10b981, #6ee7b7); color:white;}
.btn-ghost{background:transparent;}
.stage{display:grid; grid-template-columns: 1fr 340px; gap:18px; padding:18px;}
.card{border-radius:22px; padding:22px; border:1px solid var(--panel-border); min-height:220px; display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative;}
.card .tag{position:absolute; top:12px; left:12px; font-size:12px; color:var(--muted); background:white; border:1px solid var(--panel-border); padding:6px 10px; border-radius:999px; display:flex; align-items:center; gap:6px;}
.card .dot{width:10px; height:10px; border-radius:50%;}
.card h2{margin:10px 0 6px;}
.confirmed .grid{display:grid; grid-template-columns: repeat(auto-fill,minmax(210px,1fr)); gap:14px;}
.mini{border:1px solid var(--panel-border); border-radius:16px; padding:12px; position:relative;}
.mini .dot{width:8px; height:8px; border-radius:50%; display:inline-block; margin-right:6px;}
.mini .del{position:absolute; top:8px; right:8px; border:0; border-radius:999px; padding:4px 8px; background:red; color:white; font-size:12px;}
/* === 主題顏色 === */
.topic-a {background:linear-gradient(180deg, #ffe5ec, #fff);}
.topic-b {background:linear-gradient(180deg, #e0f7ff, #fff);}
.topic-c {background:linear-gradient(180deg, #e8f5e9, #fff);}
.topic-d {background:linear-gradient(180deg, #fff9e6, #fff);}
.dot.topic-a{background:#ff80a1;}
.dot.topic-b{background:#4dc3ff;}
.dot.topic-c{background:#66cc66;}
.dot.topic-d{background:#ffd54d;}
</style>
</head>
<body>
<div class="wrap">
  <header style="display:flex; justify-content:space-between; align-items:center;">
    <h1>抽卡互動網站</h1>
    <button id="btnReset" class="btn-ghost">重置</button>
  </header>

  <section class="panel controls">
    <div>
      <label for="topicSelect">主題：</label>
      <select id="topicSelect"><option value="" selected disabled>請選擇主題</option></select>
    </div>
    <div>
      <label for="categorySelect">分類：</label>
      <select id="categorySelect" disabled><option value="" selected disabled>請先選主題</option></select>
    </div>
    <button id="btnDraw" class="btn-primary" disabled>抽卡</button>
    <button id="btnReroll" class="btn-secondary" disabled>再抽一次</button>
    <button id="btnConfirm" class="btn-ok" disabled>確認</button>
  </section>

  <section class="panel stage">
    <div id="currentCard" class="card" data-empty="true">
      <div class="content">尚未抽卡</div>
    </div>
    <aside>
      <div>共 <span id="statTopics">0</span> 主題、<span id="statCategories">0</span> 分類、<span id="statCards">0</span> 張卡。</div>
    </aside>
  </section>

  <section class="panel confirmed">
    <h3>已確認的卡片</h3>
    <div id="confirmedGrid" class="grid"></div>
  </section>
</div>

<script>
const TOPICS=["Topic A","Topic B","Topic C","Topic D"];
const CATEGORIES=["Category 1","Category 2","Category 3","Category 4"];
const DATA={topics:{}};
TOPICS.forEach(t=>{
  DATA.topics[t]={};
  CATEGORIES.forEach(c=>{
    DATA.topics[t][c]=[];
    for(let i=1;i<=10;i++){
      DATA.topics[t][c].push({text:`${t} · ${c} · Card ${String(i).padStart(2,'0')}`});
    }
  });
});
const els={
  topicSelect:document.getElementById('topicSelect'),
  categorySelect:document.getElementById('categorySelect'),
  btnDraw:document.getElementById('btnDraw'),
  btnReroll:document.getElementById('btnReroll'),
  btnConfirm:document.getElementById('btnConfirm'),
  btnReset:document.getElementById('btnReset'),
  currentCard:document.getElementById('currentCard'),
  confirmedGrid:document.getElementById('confirmedGrid'),
  statTopics:document.getElementById('statTopics'),
  statCategories:document.getElementById('statCategories'),
  statCards:document.getElementById('statCards')
};
// 填充選單
Object.keys(DATA.topics).forEach(t=>{
  const opt=document.createElement('option');
  opt.value=t; opt.textContent=t;
  els.topicSelect.appendChild(opt);
});
function populateCategories(topic){
  els.categorySelect.innerHTML='<option value="" selected disabled>請選擇分類</option>';
  if(!topic){els.categorySelect.disabled=true; return;}
  Object.keys(DATA.topics[topic]).forEach(c=>{
    const opt=document.createElement('option');
    opt.value=c; opt.textContent=c;
    els.categorySelect.appendChild(opt);
  });
  els.categorySelect.disabled=false;
}
function updateDrawEnabled(){
  const ready=!!els.topicSelect.value && !!els.categorySelect.value;
  els.btnDraw.disabled=!(ready && current===null);
}
els.topicSelect.addEventListener('change',()=>{
  populateCategories(els.topicSelect.value);
  current=null; clearCurrentUI();
  updateDrawEnabled();
});
els.categorySelect.addEventListener('change',updateDrawEnabled);
// 統計
let categories=0,cards=0;
Object.values(DATA.topics).forEach(t=>{
  Object.values(t).forEach(cat=>{
    categories++; cards+=cat.length;
  });
});
els.statTopics.textContent=TOPICS.length;
els.statCategories.textContent=categories;
els.statCards.textContent=cards;
// 狀態
let current=null;
const confirmed=[];
const seenPool=new Set();
function randomPick(arr){return arr[Math.floor(Math.random()*arr.length)];}
function getKeysFor(topic,category){
  const list=DATA.topics[topic]?.[category]||[];
  return list.map((_,idx)=>({topic,category,idx}));
}
function pickCard(topic,category){
  const keys=getKeysFor(topic,category);
  const pool=keys;
  const {topic:t,category:c,idx}=randomPick(pool);
  const card=DATA.topics[t][c][idx];
  return {topic:t,category:c,idx,card};
}
function renderCurrent(cardState){
  const box=els.currentCard;
  box.innerHTML='';
  box.removeAttribute('data-empty');
  const topicClass='topic-'+cardState.topic.toLowerCase().replace(/\s+/g,'-');
  box.className='card '+topicClass;
  const tag=document.createElement('div'); tag.className='tag';
  const dot=document.createElement('span'); dot.className='dot '+topicClass; tag.appendChild(dot);
  tag.appendChild(document.createTextNode(`${cardState.topic} · ${cardState.category}`));
  const title=document.createElement('h2'); title.textContent=cardState.card.text?'文字卡':'圖片卡';
  const content=document.createElement('div'); content.className='content'; content.textContent=cardState.card.text||'';
  box.append(tag,title,content);
  els.btnDraw.disabled=true;
  els.btnReroll.disabled=false;
  els.btnConfirm.disabled=false;
}
function renderConfirmed(){
  els.confirmedGrid.innerHTML='';
  confirmed.forEach(item=>{
    const topicClass='topic-'+item.topic.toLowerCase().replace(/\s+/g,'-');
    const card=document.createElement('div'); card.className='mini '+topicClass;
    const del=document.createElement('button'); del.className='del'; del.dataset.uid=item.uid; del.textContent='刪除';
    const title=document.createElement('div'); title.innerHTML=`<span class="dot ${topicClass}"></span>${item.topic} · ${item.category}`;
    const meta=document.createElement('div'); meta.textContent=item.card.text;
    card.append(del,title,meta);
    els.confirmedGrid.appendChild(card);
  });
}
function clearCurrentUI(){
  els.currentCard.setAttribute('data-empty','true');
  els.currentCard.className='card';
  els.currentCard.innerHTML='<div class="content">尚未抽卡</div>';
  els.btnReroll.disabled=true;
  els.btnConfirm.disabled=true;
}
els.btnDraw.addEventListener('click',()=>{
  const t=els.topicSelect.value;
  const c=els.categorySelect.value;
  if(!t||!c) return;
  current=pickCard(t,c);
  renderCurrent(current);
});
els.btnReroll.addEventListener('click',()=>{
  if(!current) return;
  const t=els.topicSelect.value;
  const c=els.categorySelect.value;
  current=pickCard(t,c);
  renderCurrent(current);
});
els.btnConfirm.addEventListener('click',()=>{
  if(!current) return;
  const uid=Date.now().toString(36)+Math.random().toString(36).slice(2,8);
  confirmed.push({...current,uid});
  renderConfirmed();
  current=null;
  clearCurrentUI();
  updateDrawEnabled();
});
els.confirmedGrid.addEventListener('click',e=>{
  const btn=e.target.closest('button.del');
  if(!btn) return;
  const uid=btn.dataset.uid;
  const i=confirmed.findIndex(x=>x.uid===uid);
  if(i!==-1){confirmed.splice(i,1); renderConfirmed();}
});
els.btnReset.addEventListener('click',()=>{
  if(!confirm('確定要清空嗎？')) return;
  confirmed.splice(0);
  renderConfirmed();
  current=null;
  clearCurrentUI();
});
clearCurrentUI();
</script>
</body>
</html>
